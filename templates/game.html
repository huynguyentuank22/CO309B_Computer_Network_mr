<!DOCTYPE html>
<html>
<head>
    <title>Battleship Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="game-container">
        <div id="game-phase" class="game-phase">
            <h2>Phase: <span id="phase-text">Placing Ships</span></h2>
            <div id="countdown" style="display: none;"></div>
        </div>

        <div class="boards">
            <div class="board-container">
                <h2>Your Board</h2>
                <div id="my-board" class="board"></div>
            </div>
            <div class="board-container">
                <h2>Opponent's Board</h2>
                <div id="opponent-board" class="board"></div>
                <div id="turn-indicator"></div>
            </div>
        </div>
        
        <div class="controls">
            <div id="ship-placement" class="ship-placement">
                <h3>Place your ships</h3>
                <div class="ships">
                    <button data-ship="carrier" data-length="5">Carrier (5)</button>
                    <button data-ship="battleship" data-length="4">Battleship (4)</button>
                    <button data-ship="cruiser" data-length="3">Cruiser (3)</button>
                    <button data-ship="submarine" data-length="3">Submarine (3)</button>
                    <button data-ship="destroyer" data-length="2">Destroyer (2)</button>
                </div>
                <button id="rotate">Rotate</button>
                <button id="ready-btn" class="ready-button" style="display: none; margin-top: 20px;">Done</button>
            </div>
            <div id="game-status"></div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script>
        class BattleshipGame {
            constructor() {
                this.boardSize = 10;
                this.currentShip = null;
                this.orientation = 'horizontal';
                this.isPlacingShip = false;
                this.setupBoards();
                this.setupControls();
                this.setupPreview();
                this.startConnectionCheck();
                this.setupExitHandler();
            }

            setupExitHandler() {
                // Handle page unload (close/refresh/navigate away)
                window.addEventListener('beforeunload', () => {
                    // Send disconnect request to server
                    fetch('/disconnect', { 
                        method: 'POST',
                        keepalive: true  // Ensures request is sent even if page is unloading
                    });
                });
            }

            startConnectionCheck() {
                setInterval(() => {
                    fetch('/check_connection')
                        .then(response => response.json())
                        .then(data => {
                            if (!data.connected) {
                                // Show disconnect message if provided
                                const message = data.status || 'Connection lost';
                                alert(message);
                                // Navigate back to lobby
                                window.location.href = '/lobby';
                            }
                        })
                        .catch(error => console.error('Connection check error:', error));
                }, 2000);
            }

            // ... rest of the class code ...
        }

        document.addEventListener('DOMContentLoaded', () => {
            new BattleshipGame();
        });
    </script>
</body>
</html> 